define(["core","tpl"],function(c,e){var o={page:1,type:0,init:function(){o.page=1,0<$("#tab a").length?($("#tab a").unbind("click").click(function(e){e.preventDefault();var t=this;$("#tab a").removeClass("active"),$(t).addClass("active"),"type0"==$(t).data("tab")?o.type=0:"type1"==$(t).data("tab")&&(o.type=1),$(".container").html(""),o.page=1,o.getList(),$(".fui-content").infinite({onLoading:function(){o.getList()}}),$(".btn-edit").unbind("click").click(function(){o.changeMode()}),$(".editcheckall").unbind("click").click(function(){var e=$(this).find(":checkbox").prop("checked");$(".edit-item").prop("checked",e),o.caculateEdit()}),$(".btn-delete").unbind("click").click(function(){$(".edit-item:checked").length<=0||o.remove()})}),$("#tab a").first().click()):(1==o.page&&o.getList(),$(".fui-content").infinite({onLoading:function(){o.getList()}}),$(".btn-edit").unbind("click").click(function(){o.changeMode()}),$(".editcheckall").unbind("click").click(function(){var e=$(this).find(":checkbox").prop("checked");$(".edit-item").prop("checked",e),o.caculateEdit()}),$(".btn-delete").unbind("click").click(function(){$(".edit-item:checked").length<=0||o.remove()}))},caculateEdit:function(){$(".editcheckall .fui-radio").prop("checked",$(".edit-item").length==$(".edit-item:checked").length),0<$(".edit-item:checked").length?$(".btn-delete").removeClass("disabled"):$(".btn-delete").addClass("disabled")},changeMode:function(){if($(".goods-item").length<=0)return $(".container").hide(),$(".btn-edit").html(""),$(".editmode").html(""),void $(".content-empty").show();"favorite"==o.status?($(".fui-content").addClass("navbar"),$(".edit-item").prop("checked",!1),$(".editcheckall").prop("checked",!1),$(".editmode").show(),o.status="edit",$(".btn-edit").html("完成"),$(".favoritecover").show()):($(".fui-content").removeClass("navbar"),$(".editmode").hide(),o.status="favorite",$(".btn-edit").html("编辑"),$(".favoritecover").hide())},getUrl:function(){var e="";return 0==o.type?e="member/favorite/get_list":1==o.type&&(e="merch/member/favorite/get_list"),e},getToggleUrl:function(){var e="";return 0==o.type?e="member/favorite/toggle":1==o.type&&(e="merch/member/favorite/toggle"),e},getTpl:function(){var e="";return 0==o.type?e="tpl_member_favorite_list":1==o.type&&(e="tpl_merch_member_favorite_list"),e},getList:function(){var e=o.getUrl();c.json(e,{page:o.page},function(e){var t=e.result;t.total<=0?($(".btn-edit").hide(),$(".container").hide(),$(".content-empty").show(),$(".fui-content").infinite("stop")):($(".btn-edit").show(),$(".container").show(),$(".content-empty").hide(),$(".fui-content").infinite("init"),(t.list.length<=0||t.list.length<t.pagesize)&&$(".fui-content").infinite("stop")),o.page++;var i=o.getTpl();c.tpl(".container",i,t,1<o.page),$(".edit-item").unbind("click").click(function(){o.caculateEdit()})})},toggle:function(i,e,n){var t=o.getToggleUrl();c.json(t,{id:i,isfavorite:e},function(e){if(0==e.status){if("请先登录!"!=e.result.message)return FoxUI.toast.show(e.result.message),!1;var t=c.getUrl("goods/detail",{id:i});return t=t.replace("./index.php?",""),require(["biz/member/account"],function(e){e.initQuick({action:"login",backurl:btoa(t),success:function(){o.toggle(i,1,n)}})}),n&&n(!1),!1}n&&n(e.result.isfavorite)},!1,!0)},remove:function(t,e){t=[];$(".edit-item:checked").each(function(){var e=$(this).closest(".goods-item").data("id");t.push(e)}),t.length<=0||FoxUI.confirm("确认取消关注这些商品吗?",function(){c.json("member/favorite/remove",{ids:t},function(e){0!=e.status?($.each(t,function(){$(".goods-item[data-id='"+this+"']").prev().remove(),$(".goods-item[data-id='"+this+"']").remove()}),o.changeMode()):FoxUI.toast.show(e.result)},!0,!0)})}};return o});