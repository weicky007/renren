define(["core","tpl","https://api.map.baidu.com/getscript?v=2.0&ak=ZQiFErjQB7inrGpx27M1GR5w3TxZ64k7&services=&t=20170324173232"],function(n,t){var s={page:1,loaded:!1,init:function(t,e,i){s.type=t,s.ids=e,s.merchid=i,s.isneer=0,$(".container").empty(),$(".fui-content").infinite({onLoading:function(){s.isneer?s.getList(s.lng,s.lat):s.getList()}}),s.page=1,$(".store-item").length<=0&&($(".container").html(""),s.getList()),window.HOST_TYPE="2",window.BMap_loadScriptTime=(new Date).getTime(),s.bindEvents(),void 0!==window.selectedStoreData&&($(".store-item .fui-list-media i").removeClass("selected"),$(".store-item[data-storeid='"+window.selectedStoreData.id+"'] .fui-list-media i").addClass("selected")),$(".fui-searchbar input").bind("keyup",function(t){if(13===t.keyCode){var e=$.trim($(this).val());""==e?$(".store-item").show():(s.page=1,s.getList(s.lng,s.lat,e))}}),$(".fui-searchbar .searchbar-cancel").click(function(){$(".fui-searchbar input").val(""),$(".store-item").show(),$(".content-empty").hide()}),$("#btn-near").click(function(){s.page=1,FoxUI.loader.show("正在定位...","icon icon-location"),$(".fui-searchbar input").val(""),$(".store-item").show(),$(".content-empty").hide();var n="",a="";new AMap.Map("amap-container").plugin("AMap.Geolocation",function(){new AMap.Geolocation({enableHighAccuracy:!0,timeout:5e3,maximumAge:0}).getCurrentPosition(function(t,e){if("complete"==t){n=e.position.lat,a=e.position.lng;var i=s.TxMapToBdMap(n,a);s.lat=i.lat,s.lng=i.lng,s.isneer=1,$(".container").empty(),s.getList(a,n)}else{(new BMap.Geolocation).getCurrentPosition(function(t){if(this.getStatus()!=BMAP_STATUS_SUCCESS)return FoxUI.loader.hide(),void FoxUI.toast.show("位置获取失败!");n=t.point.lat,a=t.point.lng,s.lat=n,s.lng=a,s.isneer=1,$(".container").empty(),s.getList(a,n)},{enableHighAccuracy:!0})}})})}),$(".icon-xiangqing-copy").click(function(){var t=$(this).closest(".fui-list").data("address"),e=$(this).closest(".fui-list").data("realname"),i=$(this).closest(".fui-list").data("mobile"),n=$(this).closest(".fui-list").data("map"),a=$(this).closest(".fui-list").data("storename");$("#shopmask").find(".shopmask-title").html(a),$("#shopmask").find(".address").find("div").html(t),$("#shopmask").find(".address").find("a").attr("href",n),$("#shopmask").find(".mobile").find("div").html(i),$("#shopmask").find(".mobile").closest("a").attr("href","tel:"+i),$("#shopmask").find(".realname").find("div").html(e),$("#shopmask").css("display","block")}),$(".shopmask-bottom").click(function(){$("#shopmask").css("display","none")})},getList:function(t,e,i){FoxUI.loader.hide(),i=i||"",n.json("store/selector/get_list",{page:s.page,type:s.type,ids:s.ids,isneer:s.isneer,lng:t,lat:e,keyword:i,merchid:s.merchid},function(t){var e=t.result;e.total<=0?($(".container").hide(),$(".content-empty").show(),$(".fui-content").infinite("stop")):($(".container").show(),$(".content-empty").hide(),$(".fui-content").infinite("init"),(e.list.length<=0||e.list.length<e.pagesize)&&$(".fui-content").infinite("stop")),e.isneer=s.isneer,n.tpl(".container","tpl_store_list",e,1<s.page),e.list.length>=e.pagesize&&s.page++,s.bindEvents()})},bindEvents:function(){$(".store-item .fui-list-media,.store-item .fui-list-inner").unbind("click").click(function(){var t=$(this).parent();window.selectedStoreData={id:t.data("storeid"),storename:t.find(".storename").html(),realname:t.find(".realname").html(),mobile:t.find(".mobile").html(),address:t.find(".address").html()},history.back()})},click:function(){},TxMapToBdMap:function(t,e){var i=new Object,n=52.35987755982988,a=new Number(e),s=new Number(t),o=Math.sqrt(a*a+s*s)+2e-5*Math.sin(s*n),l=Math.atan2(s,a)+3e-6*Math.cos(a*n),r=o*Math.cos(l)+.0065,c=o*Math.sin(l)+.006;return i.lng=r,i.lat=c,i}};return s});