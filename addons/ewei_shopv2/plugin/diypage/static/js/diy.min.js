define(["jquery.ui","../../../../static/js/web/goods_selector.js"],function(e,u){var s,c,g={sysinfo:null,id:0,type:1,navs:{},initnav:[],data:{},selected:"page",childid:null,keyworderr:!1};function l(e,t){var i=c.indexOf(e.charAt(t));if(-1===i)throw"Cannot decode base64";return i}function d(e,t){for(;0<e.length;){var i=e[0];if(i<128)e.shift(),t.push(String.fromCharCode(i));else if(192==(128&i)){if(e.length<2)break;i=e.shift();var a=e.shift();t.push(String.fromCharCode(((31&i)<<6)+(63&a)))}else{if(e.length<3)break;i=e.shift();a=e.shift();var o=e.shift();t.push(String.fromCharCode(((15&i)<<12)+((63&a)<<6)+(63&o)))}}}return jQuery.base64=(jQuery,s="=",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",{decode:function(e){var t,i,a=0,o=e.length,r=[],n=[];if(e=String(e),0===o)return e;if(o%4!=0)throw"Cannot decode base64";for(e.charAt(o-1)===s&&(a=1,e.charAt(o-2)===s&&(a=2),o-=4),t=0;t<o;t+=4)l(e,t),l(e,t+1),l(e,t+2),l(e,t+3),i=l(e,t)<<18|l(e,t+1)<<12|l(e,t+2)<<6|l(e,t+3),n.push(i>>16),n.push(i>>8&255),n.push(255&i),d(n,r);switch(a){case 1:i=l(e,t)<<18|l(e,t+1)<<12|l(e,t+2)<<6,n.push(i>>16),n.push(i>>8&255);break;case 2:i=l(e,t)<<18|l(e,t+1)<<12,n.push(i>>16)}if(d(n,r),0<n.length)throw"Cannot decode base64";return r.join("")},encode:function(e){if(1!==arguments.length)throw"SyntaxError: exactly one argument required";if(0===(e=String(e)).length)return e;var t,i,a,o,r=[],n=[],l=e.length;for(t=0;t<l;){for(a=e.charCodeAt(t),o=r,a<128?o.push(a):(a<2048?o.push(192+(a>>6&31)):(o.push(224+(a>>12&15)),o.push(128+(a>>6&63))),o.push(128+(63&a)));3<=r.length;)i=r.shift()<<16|r.shift()<<8|r.shift(),n.push(c.charAt(i>>18)),n.push(c.charAt(i>>12&63)),n.push(c.charAt(i>>6&63)),n.push(c.charAt(63&i));t++}switch(r.length){case 1:i=r.shift()<<16,n.push(c.charAt(i>>18)+c.charAt(i>>12&63)+s+s);break;case 2:i=r.shift()<<16|r.shift()<<8,n.push(c.charAt(i>>18)+c.charAt(i>>12&63)+c.charAt(i>>6&63)+s)}return n.join("")},VERSION:"1.1"}),g.init=function(e){window.tpl=e.tpl,g.attachurl=e.attachurl,g.type=e.type,g.data=e.data,g.id=e.id,g.diymenu=e.diymenu,g.diyadvs=e.diyadvs,g.levels=e.levels,g.merch=e.merch,g.merchid=e.merchid,g.plugins=e.plugins?e.plugins:{},g.shopset=e.shopset,g.data&&(g.type=g.data.page.type,g.page=g.data.page,g.items=g.data.items),g.initTpl(),g.initPage(),g.initItems(),g.initNavs(),g.initSortable(),g.initGotop(),$(".btn-save").unbind("click").click(function(){var e=$(this).data("status"),t=$(this).data("type");if(e)tip.msgbox.err("正在保存，请稍候。。。");else if("preview"==t)g.save(!0);else if("save"==t)g.save();else if(t="savetemp")return void g.initTemp()}),$("#page").unbind("click").click(function(){"page"!=g.selected&&(g.selected="page",g.initPage())}),$(".diy-toolbar .btn-copy").unbind("click").click(function(e){var i=$(".selected").data("itemid"),t=g.items[i].id,a=$.extend(!0,{},g.items[i]);if(delete a.name,a){var o=$("#tpl_show_"+t).length,r=$("#tpl_edit_"+t).length;if(0!=o&&0!=r)if("diymod"!==t){var n;i=g.getId("M",0);if(a.data){var l=$.extend(!0,{},a.data),s={},c=0;$.each(l,function(e,t){var i=g.getId("C",c);s[i]=t,delete i,c++}),a.data=s}if(a.max&&0<a.max)if(0<(n=g.getItemNum(t))&&n>=a.max)return void tip.msgbox.err("此元素最多允许添加 "+a.max+" 个");if(a.only&&"toptab"==a.only)if(0<(n=g.getItemOnlyNum(a.only)))return void tip.msgbox.err("已有顶部固定元素，请删除后再添加");var d=!0;if(g.selected&&"page"!=g.selected){var p=g.items[g.selected];"detail_navbar"!=p.id&&"detail_pullup"!=p.id&&"detail_navbar"!=t&&"detail_pullup"!=t||(d=!1)}if(a.istop)(m={})[i]=a,$.each(g.items,function(e,t){m[e]=t}),g.items=m;else if(g.selected&&"page"!=g.selected&&d){var m={};$.each(g.items,function(e,t){m[e]=t,e==g.selected&&(m[i]=a)}),g.items=m}g.initItems(),$(".drag[data-itemid='"+i+"']").trigger("mousedown").trigger("click"),g.selected=i}else g.initMod(a);else tip.msgbox.err("添加失败！模板错误，请刷新页面重试")}else tip.msgbox.err("未找到此元素！")}),$(".diy-toolbar .btn-del").unbind("click").click(function(e){var t=$(".selected").data("itemid");$(this).closest(".drag").hasClass("nodelete")?tip.alert("此元素禁止删除"):tip.confirm("确定删除吗",function(){var e=g.getNear(t);delete g.items[t],g.initItems(),e?$(document).find(".drag[data-itemid='"+e+"']").trigger("mousedown"):$("#page").trigger("click")})});var t=util.cookie.get("preview_id");t&&(setTimeout(function(){var e=biz.url("diypage/page/preview")+"&id="+t;window.open(e)},1e3),util.cookie.set("preview_id",""))},g.initNavs=function(){g.getNavs();var e={0:["listmenu","richtext","title","video","line","blank","menu","menu2","picture","banner","picturew","pictures","icongroup","audio","coupon","tabbar","topmenu"],1:["search","fixedsearch","notice","goods","merchgroup","diymod","groupsgoods"],2:["search","fixedsearch","notice","goods","merchgroup","seckillgroup","diymod","groupsgoods"],3:["member","bindmobile","logout","wxcard","verify"],4:["memberc","commission_block","commission_sharecode","blockgroup"],5:["detail_tab","detail_swipe","detail_info","detail_sale","detail_spec","detail_package","detail_shop","detail_store","detail_buyshow","detail_comment","detail_pullup","detail_navbar","detail_seckill","goods","groupsgoods"],6:["goods","search","merchgroup"],7:["seckill_times","seckill_rooms","seckill_advs","seckill_list"],8:["exchange_banner","exchange_input","exchange_rule"],9:["tabbar"]},u=e[g.type],a=[],o=g.type;u=u?$.merge(u,e[0]):e[0],$.each(u,function(e,t){var i=g.navs[t];if(i){if(5==o&&"tabbar"==t)return;if(i.id=t,i.global)return void a.push(i);g.initnav.push(i)}});for(var t=[],i=0;i<g.initnav.length;i++)"merchgroup"!=g.initnav[i].id&&t.push(g.initnav[i]);g.plugins.merch||(g.initnav=t);var r=tpl("tpl_navs",{basic:g.initnav,global:a,navpageType:o});$("#navs").html(r).show(),$("#navs nav").unbind("click").click(function(){var e=$(this).data("id");if("page"!==e)if("merchgroup"!=e||g.plugins.merch)if("seckillgroup"!=e&&"detail_seckill"!=e||g.plugins.seckill)if($.inArray(e,u)<0)tip.msgbox.err("此页面类型禁止添加此元素！");else{var i=$.extend(!0,{},g.navs[e]);if(delete i.name,i){var t=$("#tpl_show_"+e).length,a=$("#tpl_edit_"+e).length;if(0!=t&&0!=a)if("diymod"!==e){var o,r=g.getId("M",0);if(i.data){var n=$.extend(!0,{},i.data),l={},s=0;$.each(n,function(e,t){var i=g.getId("C",s);l[i]=t,delete i,s++}),i.data=l}if(i.max&&0<i.max)if(0<(o=g.getItemNum(e))&&o>=i.max)return void tip.msgbox.err("此元素最多允许添加 "+i.max+" 个");if(i.only&&"toptab"==i.only)if(0<(o=g.getItemOnlyNum(i.only)))return void tip.msgbox.err("已有顶部固定元素，请删除后再添加");var c=!0;if(g.selected&&"page"!=g.selected){var d=g.items[g.selected];"detail_navbar"!=d.id&&"detail_pullup"!=d.id&&"detail_navbar"!=e&&"detail_pullup"!=e||(c=!1)}if(i.istop)(p={})[r]=i,$.each(g.items,function(e,t){p[e]=t}),g.items=p;else if(g.selected&&"page"!=g.selected&&c){var p={};$.each(g.items,function(e,t){p[e]=t,e==g.selected&&(p[r]=i)}),g.items=p}else if(5==g.page.type&&g.items&&"detail_navbar"!=e){var m=null,f=null;$.each(g.items,function(e,t){"detail_navbar"==t.id?(m={itemid:e,item:t},delete g.items[e]):"detail_pullup"==t.id&&(f={itemid:e,item:t},delete g.items[e])}),g.items[r]=i,f&&(g.items[f.itemid]=f.item),m&&(g.items[m.itemid]=m.item)}else g.items[r]=i;g.initItems(),$(".drag[data-itemid='"+r+"']").trigger("mousedown").trigger("click"),g.selected=r}else g.initMod(i);else tip.msgbox.err("添加失败！模板错误，请刷新页面重试")}else tip.msgbox.err("未找到此元素！")}else tip.msgbox.err("禁止添加此元素！");else tip.msgbox.err("未开启多商户，禁止添加此元素！");else $("#page").trigger("click")})},g.getId=function(e,t){return e+(+new Date+t)},g.getNavs=function(){g.navs={notice:{name:"公告",params:{iconurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/hotdot.png",noticedata:"0",speed:"4",noticenum:"5"},style:{background:"#ffffff",iconcolor:"#fd5454",color:"#666666",bordercolor:"#e2e2e2"},data:{C0123456789101:{title:"这里是第一条自定义公告的标题",linkurl:""},C0123456789102:{title:"这里是第二条自定义公告的标题",linkurl:""}}},banner:{name:"图片轮播",params:{},style:{dotstyle:"round",dotalign:"left",background:"#ffffff",leftright:"5",bottom:"5",opacity:"0.8"},data:{C0123456789101:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/banner-1.jpg",linkurl:""},C0123456789102:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/banner-2.jpg",linkurl:""}}},richtext:{name:"富文本",params:{content:""},style:{background:"#ffffff",padding:"0"}},title:{name:"标题栏",params:{title:"",icon:""},style:{background:"#ffffff",color:"#666666",textalign:"left",fontsize:"12",paddingtop:"5",paddingleft:"5"}},search:{name:"搜索框",params:{placeholder:"请输入关键字进行搜索"},style:{inputbackground:"#ffffff",background:"#f1f1f2",iconcolor:"#b4b4b4",color:"#999999",paddingtop:"10",paddingleft:"10",textalign:"left",searchstyle:""}},line:{name:"辅助线",params:{},style:{height:"2",background:"#ffffff",border:"#000000",padding:"10",linestyle:"solid"}},blank:{name:"辅助空白",params:{},style:{height:"20",background:"#ffffff"}},menu:{name:"按钮组",params:{},style:{navstyle:"",background:"#ffffff",rownum:"4",showtype:"0",pagenum:"8",showdot:"1"},data:{C0123456789101:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon-1.png",linkurl:"",text:"按钮文字1",color:"#666666"},C0123456789102:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon-2.png",linkurl:"",text:"按钮文字2",color:"#666666"},C0123456789103:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon-3.png",linkurl:"",text:"按钮文字3",color:"#666666"},C0123456789104:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon-4.png",linkurl:"",text:"按钮文字4",color:"#666666"}}},menu2:{name:"按钮组2",params:{},style:{margintop:"10",background:"#ffffff"},data:{C0123456789101:{text:"我的积分",iconclass:"",textcolor:"#666666",iconcolor:"#666666",linkurl:""},C0123456789102:{text:"兑换记录",iconclass:"",textcolor:"#666666",iconcolor:"#666666",linkurl:""}}},picture:{name:"单图组",params:{},style:{paddingtop:"0",paddingleft:"0"},data:{C0123456789101:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/banner-1.jpg",linkurl:""},C0123456789102:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/banner-2.jpg",linkurl:""}}},picturew:{name:"图片橱窗",params:{row:"4",showtype:0,pagenum:"2"},style:{paddingtop:"0",paddingleft:"0",showdot:0,showbtn:0},data:{C0123456789101:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/cube-1.jpg",linkurl:""},C0123456789102:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/cube-2.jpg",linkurl:""},C0123456789103:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/cube-3.jpg",linkurl:""},C0123456789104:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/cube-4.jpg",linkurl:""}}},pictures:{name:"图片展播",params:{hidetext:0,showtype:0,rownum:3,showbtn:0},style:{background:"#ffffff",paddingtop:"3",paddingleft:"5",titlealign:"left",textalign:"left",titlecolor:"#ffffff",textcolor:"#666666"},data:{C0123456789101:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-1.jpg",linkurl:"",title:"这里是上标题",text:"这里是下标题"},C0123456789102:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-2.jpg",linkurl:"",title:"这里是上标题",text:"这里是下标题"},C0123456789103:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-4.jpg",linkurl:"",title:"这里是上标题",text:"这里是下标题"}}},goods:{name:"商品组",params:{goodstype:"0",showtitle:"1",showprice:"1",showtag:"0",goodsdata:"0",cateid:"",catename:"",groupid:"",groupname:"",goodssort:"0",goodsnum:"6",showicon:"1",iconposition:"left top",productprice:"1",showproductprice:"0",showsales:"0",productpricetext:"原价",salestext:"销量",productpriceline:"0",saleout:"0",pagetype:g.page.type,seecommission:0,cansee:0,seetitle:""},style:{background:"#f3f3f3",liststyle:"block",buystyle:"buybtn-1",goodsicon:"recommand",iconstyle:"triangle",pricecolor:"#ff5555",productpricecolor:"#666666",iconpaddingtop:"0",iconpaddingleft:"0",buybtncolor:"#ff5555",iconzoom:"100",titlecolor:"#000000",tagbackground:"#fe5455",productpricecolor:"#999999",salescolor:"#999999"},data:{C0123456789101:{thumb:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-1.jpg",price:"20.00",productprice:"99.00",title:"这里是商品标题",sales:"0",gid:"",bargain:0,credit:0,ctype:1},C0123456789102:{thumb:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-2.jpg",price:"20.00",productprice:"99.00",title:"这里是商品标题",sales:"0",gid:"",bargain:0,credit:0,ctype:1},C0123456789103:{thumb:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-3.jpg",price:"20.00",productprice:"99.00",sales:"0",title:"这里是商品标题",gid:"",bargain:0,credit:0,ctype:0},C0123456789104:{thumb:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-4.jpg",price:"20.00",productprice:"99.00",sales:"0",title:"这里是商品标题",gid:"",bargain:0,credit:0,ctype:0}}},groupsgoods:{max:1,name:"拼团商品组",params:{goodstype:"0",showtitle:"1",showprice:"1",showtag:"0",goodsdata:"0",cateid:"",catename:"",groupid:"",groupname:"",goodssort:"0",goodsnum:"6",showicon:"1",iconposition:"left top",productprice:"1",showproductprice:"0",showsales:"0",productpricetext:"原价",salestext:"销量",productpriceline:"0",saleout:"0",pagetype:g.page.type,seecommission:0,cansee:0,seetitle:""},style:{background:"#f3f3f3",liststyle:"block",buystyle:"buybtn-1",goodsicon:"recommand",iconstyle:"triangle",pricecolor:"#ff5555",productpricecolor:"#666666",iconpaddingtop:"0",iconpaddingleft:"0",buybtncolor:"#ff5555",groupscorner:"#ff5555",iconzoom:"100",titlecolor:"#000000",tagbackground:"#fe5455",productpricecolor:"#999999",salescolor:"#999999"},data:{C0123456789101:{thumb:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-1.jpg",price:"20.00",productprice:"99.00",title:"这里是商品标题",sales:"0",gid:"",bargain:0,credit:0,ctype:1},C0123456789102:{thumb:"../addons/ewei_shopv2/plugin/diypage/static/images/default/goods-2.jpg",price:"20.00",productprice:"99.00",title:"这里是商品标题",sales:"0",gid:"",bargain:0,credit:0,ctype:1}}},diymod:{name:"公用模块",params:{modid:"",modname:""},style:{}},listmenu:{name:"列表导航",params:{},style:{margintop:"10",background:"#ffffff",iconcolor:"#999999",textcolor:"#000000",remarkcolor:"#888888"},data:{C0123456789101:{text:"文字1",linkurl:"",iconclass:"icon-home",remark:"查看",dotnum:""},C0123456789102:{text:"文字2",linkurl:"",iconclass:"icon-home",remark:"查看",dotnum:""},C0123456789103:{text:"文字3",linkurl:"",iconclass:"icon-home",remark:"查看",dotnum:""}}},wxcard:{name:"微信会员卡",max:1,type:3,params:{iconclass:"icon-same"},style:{margintop:"10",background:"#ffffff",iconcolor:"#999999",textcolor:"#333333",remarkcolor:"#888888"}},verify:{name:"待使用商品",max:1,type:3,params:{title:"待使用商品",remark:"",iconclass:"icon-list",style:""},style:{titlecolor:"#333333",remarkcolor:"#888888",titlebg:"#ffffff",background:"#ffffff"}},member:{name:"会员信息",type:3,max:1,params:{style:"default1",levellink:"",seticon:"icon-settings",setlink:"",leftnav:"充值",leftnavlink:"",rightnav:"兑换",rightnavlink:""},style:{background:"#ff5555",textcolor:"#ffffff",textlight:"#ffffff",headstyle:""},info:{avatar:"",nickname:"",levelname:"",textmoney:"",textcredit:"",money:"",credit:""}},icongroup:{name:"图标组",params:{rownum:"4",border:"1",bordertop:"1",borderbottom:"1"},style:{background:"#ffffff",bordercolor:"#ffffff",textcolor:"#000000",iconcolor:"#666666",dotcolor:"#ff0011"},data:{C0123456789101:{iconclass:"icon-daifukuan",text:"待付款",linkurl:"",dotnum:0},C0123456789102:{iconclass:"icon-fahuo",text:"待发货",linkurl:"",dotnum:0},C0123456789103:{iconclass:"icon-daishouhuo",text:"待收货",linkurl:"",dotnum:0},C0123456789104:{iconclass:"icon-daituikuan",text:"退换货",linkurl:"",dotnum:0}}},bindmobile:{name:"绑定手机",type:3,max:1,params:{linkurl:"",title:"绑定手机号",text:"如果您用手机号注册过会员或您想通过微信外购物请绑定您的手机号码",iconclass:"icon-mobile"},style:{margintop:"10",background:"#ffffff",titlecolor:"#ff5555",textcolor:"#999999",iconcolor:"#999999"}},logout:{name:"退出登录",type:3,max:1,params:{bindurl:"",logouturl:""},style:{subcolor:"#ffffff",maincolor:"#ff5555",margintop:"10"}},video:{name:"视频组",style:{ratio:0},params:{videourl:"",poster:""}},memberc:{name:"会员信息",type:4,max:1,params:{style:"default1",seticon:"icon-settings",setlink:"",leftnav:"提现1",leftnavlink:"",rightnav:"提现2",rightnavlink:"",centernav:"提现",centernavlink:"",hideup:0},style:{background:"#fe5455",textcolor:"#ffffff",textlight:"#ffffff"}},commission_block:{name:"佣金信息",style:{background:"#ffffff",pricecolor:"#ff8000",textcolor:"#000000",btncolor:"#ff8000"},type:4,max:1},commission_sharecode:{name:"邀请码",style:{background:"#ffffff",textcolor:"#000000",iconcolor:"#ff8000"},params:{iconclass:"icon-link"},type:4,max:1},blockgroup:{name:"图标块",params:{rownum:3,newstyle:1},style:{background:"#ffffff",tipcolor:"#feb312"},data:{C0123456789101:{iconclass:"icon-money",iconcolor:"#feb312",text:"分销佣金",textcolor:"#666666",linkurl:"",tipnum:"",tiptext:""},C0123456789102:{iconclass:"icon-list",iconcolor:"#50b6fe",text:"佣金明细",textcolor:"#666666",linkurl:"",tipnum:"50",tiptext:"笔"},C0123456789103:{iconclass:"icon-manageorder",iconcolor:"#ff741d",text:"提现明细",textcolor:"#666666",linkurl:"",tipnum:"10",tiptext:"笔"},C0123456789104:{iconclass:"icon-group",iconcolor:"#ff741d",text:"我的下线",textcolor:"#666666",linkurl:"",tipnum:"2",tiptext:"人"},C0123456789105:{iconclass:"icon-qrcode",iconcolor:"#feb312",text:"推广二维码",textcolor:"#666666",linkurl:"",tipnum:"",tiptext:""},C0123456789106:{iconclass:"icon-shopfill",iconcolor:"#50b6fe",text:"小店设置",textcolor:"#666666",linkurl:"",tipnum:"",tiptext:""},C0123456789107:{iconclass:"icon-rank",iconcolor:"#ff741d",text:"佣金排名",textcolor:"#666666",linkurl:"",tipnum:"",tiptext:""}}},detail_tab:{name:"选项卡",type:5,max:1,params:{goodstext:"商品",detailtext:"详情"},style:{background:"#f7f7f7",textcolor:"#666666",activecolor:"#ef4f4f"}},detail_swipe:{name:"商品图",type:5,max:1,params:{},style:{dotstyle:"rectangle",dotalign:"left",background:"#ffffff",leftright:"5",bottom:"5",opacity:"0.8"}},detail_info:{name:"商品信息",type:5,max:1,params:{hideshare:"0",share:"分享",share_link:"",share_icon:"icon-share"},style:{margintop:0,marginbottom:0,background:"#ffffff",titlecolor:"#000000",subtitlecolor:"#999999",pricecolor:"#ff5555",textcolor:"#cccccc",timecolor:"#fff2e2",timetextcolor:"#ef4f4f"}},detail_sale:{name:"营销信息",type:5,max:1,params:{},style:{margintop:0,marginbottom:0,background:"#ffffff",textcolor:"#666666",textcolorhigh:"#ef4f4f"},data:{C0123456789100:{name:"商品预售",type:"yushou"},C0123456789101:{name:"二次购买",type:"erci"},C0123456789102:{name:"会员价",type:"huiyuan"},C0123456789103:{name:"优惠",type:"youhui"},C0123456789104:{name:"积分",type:"jifen"},C0123456789105:{name:"不配送区域",type:"bupeisong"},C0123456789106:{name:"商品标签",type:"biaoqian"},C0123456789107:{name:"可用优惠券",type:"coupon"},C0123456789108:{name:"赠品",type:"zengpin"},C0123456789108:{name:"全返",type:"fullback"}}},detail_spec:{name:"商品规格",type:5,max:1,params:{},style:{background:"#ffffff",textcolor:"#333333",margintop:10,marginbottom:0}},detail_shop:{name:"店铺信息",type:5,max:1,params:{shoplogo:"../addons/ewei_shopv2/static/images/designer.jpg",shopname:"",shopdesc:"",hidenum:0,leftnavtext:"全部商品",leftnavlink:"",rightnavtext:"进店逛逛",rightnavlink:""},style:{margintop:10,marginbottom:0,background:"#ffffff",goodsnumcolor:"#333333",goodstextcolor:"#7c7c7c",rightnavcolor:"#ff5555",shopnamecolor:"#333333",shopdesccolor:"#444444"}},detail_comment:{name:"商品评价",type:5,max:1,params:{},style:{margintop:10,marginbottom:10,background:"#ffffff",maincolor:"#fd5454",subcolor:"#000",textcolor:"#333333"}},detail_buyshow:{name:"购买可见",type:5,max:1,params:{},style:{background:"#ffffff",margintop:10,marginbottom:0}},detail_store:{name:"适用门店",type:5,max:1,params:{},style:{background:"#ffffff",margintop:10,marginbottom:0,titlecolor:"#333333",shopnamecolor:"#333333",shopinfocolor:"#666666",navtelcolor:"#008000",navlocationcolor:"#ff9900"}},detail_package:{name:"相关套餐",type:5,max:1,params:{},style:{background:"#ffffff",margintop:10,marginbottom:0,textcolor:"#000000"}},detail_pullup:{name:"上拉详情",type:5,max:1,params:{},style:{margintop:10,background:"#ffffff",textcolor:"#333333"}},detail_navbar:{name:"底部导航",type:5,max:1,params:{hidelike:0,hideshop:0,hidecart:0,hidecartbtn:0,textbuy:"立刻购买",goodstext:"商品",liketext:"关注",likeiconclass:"icon-like",likelink:"icon-like",shoptext:"店铺",shopiconclass:"icon-shop",carttext:"购物车",carticonclass:"icon-cart"},style:{background:"#ffffff",textcolor:"#999999",iconcolor:"#999999",cartcolor:"#fe9402",buycolor:"#fd5555",dotcolor:"#ff0011"}},detail_seckill:{name:"秒杀条",type:5,max:1,params:{buybtntext:"原价购买"},style:{theme:"red"}},merchgroup:{name:"商户组",params:{merchdata:"0",merchnum:"6",merchsort:"",catename:"",cateid:"",groupname:"",groupid:"",openlocation:"0"},style:{background:"#ffffff",titlecolor:"#333333",textcolor:"#666666",rangecolor:"#ff5555",locationcolor:"#ff5555",margintop:"10"},data:{C0123456789101:{name:"商户名称A",desc:"这里是商户A的介绍",thumb:"",merchid:""},C0123456789102:{name:"商户名称B",desc:"这里是商户B的介绍",thumb:"",merchid:""},C0123456789103:{name:"商户名称C",desc:"这里是商户C的介绍",thumb:"",merchid:""}}},audio:{name:"音频播放",params:{title:"未定义音频信息",subtitle:"副标题",playerstyle:0,autoplay:0,loopplay:0,pausestop:0,headalign:"left",headtype:"",headurl:""},style:{background:"#f1f1f1",bordercolor:"#ededed",textcolor:"#333333",subtitlecolor:"#666666",timecolor:"#666666",paddingtop:"20",paddingleft:"20",width:"80"}},seckillgroup:{max:1,name:"秒杀组",params:{iconurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/seckill.png",hideborder:0,tag:""},style:{margintop:"10",background:"#ffffff",titlecolor:"#444444",timecolor:"#444444",timesigncolor:"#444444",timebgcolor:"#ffffff",timebordercolor:"#d9d9d9",morecolor:"#888888",marketpricecolor:"#ef4f4f",productpricecolor:"#999999"}},seckill_times:{type:7,max:1,name:"秒杀时间段",params:{},style:{}},seckill_rooms:{type:7,name:"秒杀会场",max:1,params:{},style:{}},seckill_advs:{type:7,max:1,name:"秒杀广告",params:{},style:{}},seckill_list:{type:7,name:"秒杀商品",max:1,params:{},style:{}},coupon:{name:"优惠券组",params:{couponstyle:"3"},style:{background:"#ffffff",margintop:"10",marginleft:"5"},data:{C0123456789101:{name:"优惠券名称",desc:"满100元可用",price:"89.90",couponid:"",background:"#fd5454",bordercolor:"#fd5454",textcolor:"#ffffff",couponcolor:"#55b5ff"},C0123456789102:{name:"优惠券名称",desc:"满100元可用",price:"89.90",couponid:"",background:"#ff9140",bordercolor:"#ff9140",textcolor:"#ffffff",couponcolor:"#ff5555"},C0123456789103:{name:"优惠券名称",desc:"满100元可用",price:"89.90",couponid:"",background:"#54b5fd",bordercolor:"#54b5fd",textcolor:"#ffffff",couponcolor:"#ff913f"}}},fixedsearch:{name:"固定搜索框",istop:1,max:1,only:"toptab",params:{leftnav:"1",rightnav:"1",rightnavclick:"0",leftnavicon:"icon-shop",rightnavicon:"icon-cart",searchstyle:"round",placeholder:"输入关键字进行搜索"},style:{background:"#000000",opacity:.8,opacityinput:.8,leftnavcolor:"#ffffff",rightnavcolor:"#ffffff",searchbackground:"#ffffff",searchtextcolor:"#666666"}},exchange_banner:{name:"兑换轮播图",max:1,type:8,params:{datatype:0},style:{dotstyle:"rectangle",dotalign:"left",background:"#ffffff",leftright:"5",bottom:"5",opacity:"0.8"},data:{C0123456789101:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/banner-1.jpg",linkurl:""},C0123456789102:{imgurl:"../addons/ewei_shopv2/plugin/diypage/static/images/default/banner-2.jpg",linkurl:""}}},exchange_input:{name:"兑换区域",max:1,type:8,params:{preview:"0",title:"兑换码兑换",placeholder:"请输入兑换码",btntext:"立即兑换",backbtn:"返回重新输入兑换码",exbtntext:"兑换",exbtn2text:"已兑换",crediticon:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon_credit.png",moneyicon:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon_money.png",couponicon:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon_coupon.png",redbagicon:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon_redbag.png",goodsicon:"../addons/ewei_shopv2/plugin/diypage/static/images/default/icon_goods.png"},style:{titlecolor:"#444444",btncolor:"#ffffff",btnbackground:"#ed5565",inputcolor:"#666666",inputbackground:"#ffffff",inputborder:"#efefef",codecolor:"#444444",numcolor:"#999999",exbtncolor:"#ffffff",exbtnbackground:"#ed5565",exbtn2color:"#ffffff",exbtn2background:"#cccccc",backbtncolor:"#444444",backbtnborder:"#e7eaec",backbtnbackground:"#f7f7f7",goodstitle:"#444444",goodsprice:"#aaaaaa"}},exchange_rule:{name:"兑换规则",max:1,type:8,params:{ruletitle:"兑换规则"},style:{ruletitlecolor:"#555555"}},tabbar:{name:"选项卡",style:{background:"#ffffff",color:"#666666",activebackground:"#ffffff",activecolor:"#ef4f4f",scrollnum:5,showtype:1},params:{datatype:null},data:{C0123456789101:{text:"选项",linkurl:""},C0123456789102:{text:"选项",linkurl:""},C0123456789103:{text:"选项",linkurl:""},C0123456789104:{text:"选项",linkurl:""},C0123456789105:{text:"选项",linkurl:""}}},topmenu:{name:"顶部菜单",istop:1,max:1,only:"toptab",global:!0,style:{background:"#ffffff",color:"#666666",activebackground:"#ffffff",activecolor:"#ef4f4f",scrollnum:5,showtype:1},params:{datatype:null},data:{C0123456789101:{text:"选项",linkurl:"",active:"active"},C0123456789102:{text:"选项",linkurl:""},C0123456789103:{text:"选项",linkurl:""},C0123456789104:{text:"选项",linkurl:""},C0123456789105:{text:"选项",linkurl:""}}}}},g.initItems=function(e){var t=$("#phone");if(g.items){t.empty(),$.each(g.items,function(e,t){if(void 0!==t.id){var i=$.extend(!0,{},t);i.itemid=e,"audio"==t.id&&(i.shoplogo=g.shopset?g.shopset.logo:"");var a=tpl("tpl_show_"+t.id,i);$("#phone").append(a)}});var i=$("#edit-del").html();$("#phone .drag").append(i),$("#phone .drag .btn-edit-del .btn-del").unbind("click").click(function(e){e.stopPropagation();var t=$(this).closest(".drag");console.log($(this));var i=t.data("itemid");$(this).closest(".drag").hasClass("nodelete")?tip.alert("此元素禁止删除"):tip.confirm("确定删除吗",function(){var e=g.getNear(i);delete g.items[i],g.initItems(),e?$(document).find(".drag[data-itemid='"+e+"']").trigger("mousedown"):$("#page").trigger("click")})}),e&&g.selectedItem(e)}else g.items={}},g.selectedItem=function(e){e&&("page"==(g.selected=e)?$("#page").trigger("click"):$(".drag[data-itemid='"+e+"']").addClass("selected"))},g.initPage=function(e){void 0===e&&(e=!0),g.page?7!=g.type||g.page.seckill||(g.page.seckill={style:"style1",color:"red"}):(g.page={type:g.type,title:"请输入页面标题",name:"未命名页面",desc:"",icon:"",keyword:"",background:"#f3f3f3",diymenu:"-1",diylayer:"0",diygotop:"0",followbar:"0",visit:"0",visitlevel:{member:null,commission:null},novisit:{title:null,link:null}},5==g.type?g.page.title="商品详情":7==g.type?g.page.seckill={style:"style1",color:"red"}:8==g.type?g.page.title="兑换中心":99==g.type&&(g.page.type=99,g.page.title="公用模块",g.page.name="未命名模块")),g.page.visitlevel||(g.page.visitlevel={member:null,commission:null}),g.page.novisit||(g.page.novisit={}),$("#page").text(g.page.title),$("#phone").css({"background-color":g.page.background}),$("#phone").find(".drag").removeClass("selected"),g.page.seckill&&("style1"==g.page.seckill.style?$("#phone").addClass(g.page.seckill.style).removeClass("style2"):$("#phone").addClass(g.page.seckill.style).removeClass("style1"),$("#phone").closest(".phone-body").removeClass().addClass("phone-body").addClass(g.page.seckill.color)),e&&g.initEditor()},g.initSortable=function(){$("#phone").sortable({opacity:.8,placeholder:"highlight",items:".drag:not(.fixed)",revert:100,scroll:!1,start:function(e,t){var i=t.item.height();$(".highlight").css({height:i+"px"}),$(".highlight").html('<div><i class="fa fa-plus"></i> 放置此处</div>'),$(".highlight div").css({"line-height":i-4+"px"})},stop:function(e,t){g.initEditor()},update:function(e,t){g.sortItems()}}),$("#phone").disableSelection(),$(document).on("mousedown","#phone .drag",function(){$(this).hasClass("selected")||(g.selected=$(this).data("itemid"),$("#phone").find(".drag").removeClass("selected"),$(this).addClass("selected"),g.selected=$(this).data("itemid"),g.initEditor())})},g.sortItems=function(){var t={};$("#phone .drag").each(function(){var e=$(this).data("itemid");t[e]=g.items[e]}),g.items=t},g.initEditor=function(e){void 0===e&&(e=!0);var s=g.selected,t=180;if("page"!=g.selected){var a=$(".selected").position().top;t=a||0,0<$(".wb-header").length?t+=100:t-=30}if(e&&($("#diy-editor").unbind("animate").animate({"margin-top":t-130+"px"}),setTimeout(function(){$("body").unbind("animate").animate({scrollTop:t-130+"px"},1e3)},1e3)),g.selected){if("page"==g.selected){if(99==g.type)var o=tpl("tpl_edit_page_mod",g.page);else o=tpl("tpl_edit_page",g);$("#diy-editor .inner").html(o)}else{var r=$.extend(!0,{},g.items[g.selected]);r.itemid=g.selected,r.merch=g.merch,r.plugins=g.plugins;o=tpl("tpl_edit_"+r.id,r);$("#diy-editor .inner").html(o)}$("#diy-editor").attr("data-editid",g.selected).show()}if(o?$("#diy-editor").show():$("#diy-editor").hide(),0<$("#diy-editor .slider").length&&$("#diy-editor .slider").each(function(){var a=$(this).data("decimal"),e=($(this).data("multiply"),$(this).data("value"));a&&(e*=a),$(this).slider({slide:function(e,t){var i=t.value;a&&(i/=a),$(this).siblings(".input").val(i).trigger("propertychange"),$(this).siblings(".count").find("span").text(i)},value:e,min:$(this).data("min"),max:$(this).data("max")})}),0<$("#diy-editor .goods-selector").length){var n=1==(d=$("#diy-editor .goods-selector")).data("goodstype")?"creditshop":"",l=2==d.data("pagetype")?2:0,c=g.merch?biz.url("goods/goods_selector",null,g.merch):"";d.unbind("click").click(function(){g.childid=$(this).closest(".item").data("id"),"creditshop"!=n&&(n=l),u.open("callbackGoods",n,g.merch,!1,c,!1,!1,l)})}if(0<$("#diy-editor .category-selector").length){var d=$("#diy-editor .category-selector"),p=biz.url("goods/category/query",null,g.merch);1==d.data("goodstype")&&(p=biz.url("creditshop/category/query",null,g.merch)),d.attr({id:"category_selector","data-url":p,"data-callback":"callbackCategory"}),d.unbind("click").click(function(){biz.selector.select({name:"category"})})}0<$("#diy-editor .group-selector").length&&((d=$("#diy-editor .group-selector")).attr({id:"group_selector","data-url":biz.url("goods/group/query",null,g.merch),"data-callback":"callbackGroup"}),d.unbind("click").click(function(){biz.selector.select({name:"group"})}));if($("#diy-editor .merch-selector").length){var d=$("#diy-editor .merch-selector");p=biz.url("merch/user/query",null,g.merch);d.attr({id:"merch_selector","data-url":p,"data-callback":"callbackMerch"}),d.unbind("click").click(function(){biz.selector.select({name:"merch"}),g.childid=$(this).closest(".item").data("id")})}if($("#diy-editor .merch-category-selector").length){var d=$("#diy-editor .merch-category-selector");p=biz.url("merch/category/query",null,g.merch);d.attr({id:"category_selector","data-url":p,"data-callback":"callbackMerchCategory"}),d.unbind("click").click(function(){biz.selector.select({name:"category"})})}$("#diy-editor .merch-group-selector").length&&((d=$("#diy-editor .merch-group-selector")).attr({id:"group_selector","data-url":biz.url("merch/group/query",null,g.merch),"data-callback":"callbackMerchGroup"}),d.unbind("click").click(function(){biz.selector.select({name:"group"})}));$("#diy-editor .coupon-selector").length&&((d=$("#diy-editor .coupon-selector")).attr({id:"coupon_selector","data-url":biz.url("sale/coupon/query",{diy:1,canmerch:1},g.merch),"data-callback":"callbackCoupon"}),d.unbind("click").click(function(){biz.selector.select({name:"coupon"}),g.childid=$(this).closest(".item").data("id")}));if($("#diy-editor .audio-player").length&&$("#diy-editor .audio-player").click(function(){var e=$(this),t=e.next("audio")[0],i=e.next("audio").attr("src");if(t&&i)if(t.paused){t.play(),e.find(".fa").removeClass("fa-play").addClass("fa-stop");var a=setInterval(function(){t.currentTime>=t.duration&&(t.pause(),e.find(".fa").removeClass("fa-stop").addClass("fa-play"),clearInterval(a))},1e3)}else t.currentTime=0,t.pause(),e.find(".fa").removeClass("fa-stop").addClass("fa-play");else tip.msgbox.err("请先选择音频！")}),$("#diy-editor").find('[data-toggle="setNull"]').bind("click",function(){var e=$(this).data("element");$(e).val("").trigger("propertychange")}),0<$("#diy-editor .form-items").length&&(g.initSortableChild(),$("#addChild").unbind("click").click(function(){var e=g.selected,t=g.items[e].id,i=g.navs[t].data,a=$(this).closest(".form-items").data("max");if(a&&a<=g.length(g.items[e].data))return void tip.msgbox.err("最大添加 "+a+" 个！");var o={},r=0;if($.each(i,function(e,t){0==r&&(o=t,r++)}),o){var n=g.getId("M",0);void 0===g.items[e].data&&(g.items[e].data={}),o=$.extend(!0,{},o),g.items[e].data[n]=o}g.initItems(e),g.initEditor(!1)}),$("#diy-editor .form-items .item .btn-del").unbind("click").click(function(){var e=$(this).closest(".item").data("id"),t=g.selected,i=$(this).closest(".form-items").data("min");if(i&&g.length(g.items[t].data)<=i)return void tip.msgbox.err("至少保留 "+i+" 个！");tip.confirm("确定删除吗",function(){delete g.items[t].data[e],g.initItems(t),g.initEditor(!1)})})),0<$("#diy-editor .form-richtext").length){var m={type:"image",direct:!1,multiple:!0,tabs:{upload:"active",browser:"",crawler:""},path:"",dest_dir:"",global:!1,thumb:!1,width:0};g.merch&&g.merchid&&(m.dest_dir="merch/"+g.merchid),UE.registerUI("myinsertimage",function(a,t){a.registerCommand(t,{execCommand:function(){require(["fileUploader"],function(e){e.show(function(e){if(0!=e.length)if(1==e.length)a.execCommand("insertimage",{src:e[0].url,_src:e[0].url,width:"100%",alt:e[0].filename});else{var t=[];for(i in e)t.push({src:e[i].url,_src:e[i].url,width:"100%",alt:e[i].filename});a.execCommand("insertimage",t)}},m)})}});var o=new UE.ui.Button({name:"插入图片",title:"插入图片",cssRules:"background-position: -726px -77px",onclick:function(){a.execCommand(t)}});return a.addListener("selectionchange",function(){var e=a.queryCommandState(t);-1==e?(o.setDisabled(!0),o.setChecked(!1)):(o.setDisabled(!1),o.setChecked(e))}),o},48),UE.registerUI("myinsertvideo",function(i,t){i.registerCommand(t,{execCommand:function(){require(["fileUploader"],function(e){e.show(function(e){if(e){var t=e.isRemote?"iframe":"video";i.execCommand("insertvideo",{url:e.url,width:300,height:200},t)}},{fileSizeLimit:512e4,type:"video",allowUploadVideo:!0,netWorkVideo:!0})})}});var a=new UE.ui.Button({name:"插入视频",title:"插入视频",cssRules:"background-position: -320px -20px",onclick:function(){i.execCommand(t)}});return i.addListener("selectionchange",function(){var e=i.queryCommandState(t);-1==e?(a.setDisabled(!0),a.setChecked(!1)):(a.setDisabled(!1),a.setChecked(e))}),a},20),UE.registerUI("mylink",function(t,i){var a=new UE.ui.Button({name:"selectUrl",title:"系统链接",cssRules:"background-position: -622px 80px;",onclick:function(){$("#"+this.id).attr({"data-toggle":"selectUrl","data-callback":"selectUrlCallback"})}});return t.addListener("selectionchange",function(){var e=t.queryCommandState(i);-1==e?(a.setDisabled(!0),a.setChecked(!1)):(a.setDisabled(!1),a.setChecked(e))}),a}),"undefined"!=typeof UE&&UE.delEditor("rich");var f=UE.getEditor("rich",{autoClearinitialContent:!1,toolbars:[["fullscreen","source","preview","|","bold","italic","underline","strikethrough","forecolor","backcolor","|","justifyleft","justifycenter","justifyright","|","insertorderedlist","insertunorderedlist","blockquote","emotion","removeformat","|","rowspacingtop","rowspacingbottom","lineheight","indent","paragraph","fontsize","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","anchor","map","print","drafts","|","link"]],elementPathEnabled:!1,initialFrameHeight:300,focus:!1,maximumWords:9999999999999});f.ready(function(){var e=g.items[s].params.content;e=$.base64.decode(e),f.setContent(e),f.addListener("contentChange",function(){var e=f.getContent();e=$.base64.encode(e),$("#richtext").html(e).trigger("change")})})}$("#diy-editor").find(".diy-bind").bind("input propertychange change",function(){var t=$(this),e=t.data("bind"),i=t.data("bind-child"),a=t.data("bind-parent"),o=t.data("bind-init"),r="",n=this.tagName;if(s||g.selectedItem("page "),"INPUT"==n)if("checkbox"==t.attr("type"))r=[],t.closest(".form-group").find("input[type=checkbox]").each(function(){var e=this.checked,t=$(this).val();e&&r.push(t)});else{var l=t.data("placeholder");r=""==(r=t.val())?l:r}else"SELECT"==n?r=t.find("option:selected").val():"TEXTAREA"==n&&(r=t.val());r=$.trim(r),"page"==s?(i?(g.page[i]||(g.page[i]={}),g.page[i][e]=r):g.page[e]=r,g.initPage(!1),"keyword"==e&&$.post(biz.url("diypage/page/keyword"),{id:g.id,keyword:r},function(e){0==e.status?(t.closest(".form-group").addClass("has-error"),g.keyworderr=!0):(t.closest(".form-group").removeClass("has-error"),g.keyworderr=!1)},"json")):(i?a?g.items[s][a][i][e]=r:g.items[s][i][e]=r:g.items[s][e]=r,g.initItems(s)),o&&g.initEditor(!1)})},g.initSortableChild=function(){$("#diy-editor .inner").sortable({opacity:.8,placeholder:"highlight",items:'.item:not(".nodrag")',revert:100,scroll:!1,cancel:".goods-selector,input,select,.btn,btn-del",start:function(e,t){var i=t.item.height();$(".highlight").css({height:i+22+"px"}),$(".highlight").html('<div><i class="fa fa-plus"></i> 放置此处</div>'),$(".highlight div").css({"line-height":i+16+"px"})},update:function(e,t){g.sortChildItems()}})},g.initMod=function(o){$.ajax(biz.url("diypage/page/mod/query",null,g.merch),{type:"get",dataType:"html",cache:!1}).done(function(e){modModal=$('<div class="modal fade" id="modModal"></div>'),$(document.body).append(g),modModal.modal("show"),modModal.append2(e,function(){$(document).off("click","#modModal nav").on("click","#modModal nav",function(){var e=$(this).data("id"),t=$(this).data("name");modModal.find(".close").click();var i=g.getId("M",0);if(o.params.modid=e,o.params.modname=t,g.selected&&"page"!=g.selected){var a={};$.each(g.items,function(e,t){a[e]=t,e==g.selected&&(a[i]=o)}),g.items=a}else g.items[i]=o;g.initItems(),$(".drag[data-itemid='"+i+"']").trigger("mousedown").trigger("click"),g.selected=i})})})},g.initTemp=function(){var t=0;$.each(g.items,function(e){return t++,!1}),t?99!=g.type?($("#saveTempModal").modal(),$("#saveTemp","#saveTempModal").unbind("click").click(function(){var e=$.trim($("#saveTempModal").find("#saveTempName").val()),t=$.trim($("#saveTempModal").find("#saveTempCate option:selected").val()),i=$.trim($("#saveTempModal").find("#saveTempPreview").val()),a={page:g.page,items:g.items};if(!e)return tip.msgbox.err("请填写模板名称！"),void $("#saveTempModal").find("#saveTempName").focus();if($("#saveTempModal .close").trigger("click"),1==g.type)var o=biz.url("diypage/page/diy/savetemp",null,g.merch);else if(1<g.type&&g.type<6&&4!=g.type)o=biz.url("diypage/page/sys/savetemp",null,g.merch);else if(4<g.type&&g.type<99&&5!=g.type)o=biz.url("diypage/page/plu/savetemp",null,g.merch);$.post(o,{type:g.type,cate:t,name:e,preview:i,data:a},function(e){0==e.status?tip.msgbox.err(e.result.message):tip.msgbox.suc("另存为模板保存成功！")},"json")})):tip.msgbox.err("页面类型为公用模块，不能保存为模板！"):tip.msgbox.err("您还没有添加任何元素，不能保存为模板！")},g.initTpl=function(){tpl.helper("imgsrc",function(e){return"string"!=typeof e?"":0==e.indexOf("http://")||0==e.indexOf("https://")||0==e.indexOf("../addons/ewei_shopv2/")?e:0==e.indexOf("images/")||0==e.indexOf("audios/")?g.attachurl+e:void 0}),tpl.helper("decode",function(e){return $.base64.decode(e)}),tpl.helper("count",function(e){return g.length(e)}),tpl.helper("toArray",function(e){$.makeArray(e);var i=[];return $.each(e,function(e,t){i.push(t)}),i}),tpl.helper("strexists",function(e,t){return!(!e||!t)&&-1!=e.indexOf(t)}),tpl.helper("inArray",function(e,t){if(!e||!t)return!1;if("string"==typeof e){var i=e.split(",");if(-1<$.inArray(t,i))return!0}return!1}),tpl.helper("define",function(e){})},g.initGotop=function(){$(window).bind("scroll resize",function(){300<$(window).scrollTop()?$("#gotop").show():$("#gotop").hide(),$("#gotop").unbind("click").click(function(){$("body").animate({scrollTop:"0px"},1e3)})})},g.getNear=function(i){var a=[],o=0,r=0,n=0;$.each(g.items,function(e,t){(a[o]=e)==i&&(r=o-1,n=o+1),o++});var e=a[r],t=a[n];return t||(e||!1)},g.getItemNum=function(i){if(!i||!g.items)return-1;var a=0;return $.each(g.items,function(e,t){t.id==i&&a++}),a},g.getItemOnlyNum=function(i){if(!i||!g.items)return-1;var a=0;return $.each(g.items,function(e,t){t.only==i&&a++}),a},g.sortChildItems=function(){var t={},i=g.selected;$("#diy-editor .form-items .item").each(function(){var e=$(this).data("id");t[e]=g.items[i].data[e]}),g.items[i].data=t,g.initItems(i)},g.length=function(e){if(void 0===e)return 0;var t=0;for(var i in e)t++;return t},g.callbackGoods=function(e){if(console.log(e),e){e.minprice||(e.minprice=e.marketprice);var t=g.selected,i=g.childid;g.items[t].data[i]={title:e.title,thumb:e.thumb,price:e.minprice,gid:e.id,bargain:e.bargain,credit:e.credit,seecommission:e.seecommission,cansee:e.cansee,seetitle:e.seetitle},g.initItems(t),g.initEditor(!1),g.childid=null}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackCategory=function(e){if(e){var t=g.selected;g.items[t].params.catename=e.name,g.items[t].params.cateid=e.id,g.items[t].params.groupname="",g.items[t].params.groupid="",g.initItems(t),g.initEditor(!1)}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackGroup=function(e){if(e){var t=g.selected;g.items[t].params.groupname=e.name,g.items[t].params.groupid=e.id,g.items[t].params.catename="",g.items[t].params.cateid="",g.initItems(t),g.initEditor()}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackMerch=function(e){if(e){var t=g.selected,i=g.childid;g.items[t].data[i]={name:e.merchname,thumb:e.logo,merchid:e.id,desc:e.desc},g.initItems(t),g.initEditor(!1),g.childid=null}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackMerchCategory=function(e){if(e){var t=g.selected;g.items[t].params.catename=e.catename,g.items[t].params.cateid=e.id,g.items[t].params.groupname="",g.items[t].params.groupid="",g.initItems(t),g.initEditor(!1)}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackMerchGroup=function(e){if(e){var t=g.selected;g.items[t].params.groupname=e.groupname,g.items[t].params.groupid=e.id,g.items[t].params.catename="",g.items[t].params.cateid="",g.initItems(t),g.initEditor()}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackCoupon=function(e){if(e){var t=g.selected,i=g.childid;g.items[t].data[i].price=e.values,g.items[t].data[i].desc=e.uselimit,g.items[t].data[i].couponid=e.id,g.items[t].data[i].name=e.couponname,g.initItems(t),g.initEditor(!1),g.childid=null}else tip.msgbox.err("回调数据错误，请重试！")},g.callbackData=function(e){if(e){var t=g.selected;g.childid;"topmenu"==g.items[t].id&&(g.items[t].params.datatype=e),g.initItems(t),g.initEditor(!1)}else tip.msgbox.err("回调数据错误，请重试！")},g.save=function(i){if(void 0===i&&(i=!1),i&&5==g.type)tip.msgbox.err("商品详情页涉及商品数据问题，请至手机端预览");else{if(g.keyworderr)return tip.msgbox.err("关键字已存在！"),$("#page").trigger("click"),void $("#diy-editor input[data-bind='keyword']").closest(".form-group").addClass("has-error");if(g.data={},g.data={page:g.page,items:g.items},!g.page.title)return tip.msgbox.err("页面标题是必填项"),void $("#page").trigger("click");if($(".btn-save").data("status",1).text("保存中..."),1==g.type)if(0<g.id)var e=biz.url("diypage/page/diy/edit",null,g.merch);else e=biz.url("diypage/page/diy/add",null,g.merch);else if(1<g.type&&g.type<6&&4!=g.type)if(0<g.id)e=biz.url("diypage/page/sys/edit",null,g.merch);else e=biz.url("diypage/page/sys/add",null,g.merch);else if(4<g.type&&g.type<99&&5!=g.type)if(0<g.id)e=biz.url("diypage/page/plu/edit",null,g.merch);else e=biz.url("diypage/page/plu/add",null,g.merch);else if(99==g.type)if(0<g.id)e=biz.url("diypage/page/mod/edit",null,g.merch);else e=biz.url("diypage/page/mod/add",null,g.merch);$.post(e,{id:g.id,data:g.data},function(e){if(0==e.status)return tip.msgbox.err(e.result.message),$(".btn-save[data-type='save']").text("保存页面").data("status",0),$(".btn-save[data-type='preview']").text("保存并预览").data("status",0),void $(".btn-save[data-type='savetemp']").text("另存为模板").data("status",0);var t=e.result.id;t==g.id?($(".btn-save[data-type='save']").text("保存页面").data("status",0),$(".btn-save[data-type='preview']").text("保存并预览").data("status",0),$(".btn-save[data-type='savetemp']").text("另存为模板").data("status",0),i?(tip.msgbox.suc("保存成功！正在生成预览..."),setTimeout(function(){var e=biz.url("diypage/page/preview",null,g.merch)+"&id="+t;window.open(e)},1e3)):tip.msgbox.suc("保存成功！")):(i?(tip.msgbox.suc("保存成功！正在生成预览..."),util.cookie.set("preview_id",t)):tip.msgbox.suc("保存成功！"),location.href=e.result.jump)},"json")}},g.length=function(e){if(void 0===e)return 0;var t=0;for(var i in e)t++;return t},g});