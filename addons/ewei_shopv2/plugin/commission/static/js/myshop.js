define(["core","tpl","biz/goods/picker"],function(s,d,e){var a={page:1,params:{},stop:0,indexPage:1,indexStop:!1,initSet:function(){$(".fui-uploader").uploader({uploadUrl:s.getUrl("util/uploader"),remove:!0,removeIcon:"icon icon-close",removeUrl:s.getUrl("util/uploader/remove")}),$(".btn-submit").click(function(){var e=$(this);if(!e.attr("stop")){var o=e.html(),t=$("#imageLogo").find("li:first-child"),i=$("#imageImg").find("li:first-child"),n={name:$("#shopname").val(),desc:$("#desc").val(),logo:0<t.length?t.data("filename"):"",img:0<i.length?i.data("filename"):""};e.attr("stop",1).html("正在处理..."),s.json("commission/myshop/set",{shopdata:n},function(t){if(0==t.status)return e.removeAttr("stop").html(o),void FoxUI.toast.show(t.result.message);location.href=s.getUrl("commission")},!0,!0)}})},initSelect:function(){$("#openselect").change(function(){$(this).prop("checked")?$("#divselect").show():$("#divselect").hide()}),$(".container").lazyload(),$(".menu nav").click(function(){$(".container").infinite("init");var t=$(this);t.siblings().removeClass("on"),t.addClass("on"),$(".goods-list-group").html(""),a.params={isnew:t.data("isnew")||"",ishot:t.data("ishot")||"",isrecommand:t.data("isrecommand")||"",isdiscount:t.data("isdiscount")||"",keywords:$("#keywords").val(),istime:t.data("istime")||"",cate:t.data("cate")||"",nocommission:0,order:"",by:""},a.page=1,a.stop=0,a.getList()}),$(".btn-submit").click(function(){var e=$(this);if(!e.attr("stop")){var o=e.html(),t=[];if($(".goods-selected").each(function(){t.push($(this).data("goodsid"))}),t.length<=0&&$("#openselect").prop("checked"))FoxUI.toast.show("请选择商品!");else{var i={selectgoods:$("#openselect").prop("checked")?1:0,selectcategory:$("#opencategory").prop("checked")?1:0,goodsids:t};e.attr("stop",1).html("正在处理..."),s.json("commission/myshop/select",i,function(t){if(0==t.status)return e.removeAttr("stop").html(o),void FoxUI.toast.show(t.result.message);location.href=s.getUrl("commission")},!0,!0)}}}),a.bindSelectedEvents(),$(".container").infinite({onLoading:function(){a.getList()}}),1==a.page&&a.getList()},getList:function(){0==a.stop&&(a.params.page=a.page,s.json("goods/query",a.params,function(t){var e=t.result;e.total<=0?($(".goods-list-group").hide(),$(".empty").show(),$(".container").infinite("stop")):($(".goods-list-group").show(),$(".empty").hide(),$(".container").infinite("init"),e.list.length<=0||e.list.length<e.pagesize?($(".container").infinite("stop"),a.stop=1):a.page++),s.tpl(".goods-list-group","tpl_commission_goods_select",e,1<a.page),a.bindEvents()}))},bindEvents:function(){$(".container").lazyload(),$(".fui-page").removeAttr("style"),$(".goods-list-group .goods-item").each(function(){var t=$(this).data("goodsid");0<$(".goods-selected[data-goodsid='"+t+"']").length&&$(this).find(":checkbox").prop("checked",!0)}),$(".goods-list-group .fui-switch").click(function(){var t=$(this),e=t.prop("checked"),o=t.closest(".goods-item").data("goodsid");if(e){if($(".goods-selected[data-goodsid='"+o+"']").length<=0){var i=$(this).closest(".goods-item"),n=d("tpl_commission_goods_item",{g:{id:o,title:i.data("title"),marketprice:i.data("marketprice"),thumb:i.data("thumb")}});$(".goods-selected-group").prepend(n)}}else 0<$(".goods-selected[data-goodsid='"+o+"']").length&&$(".goods-selected[data-goodsid='"+o+"']").remove();0<$(".goods-selected").length?($(".goods-selected-group").show(),a.bindSelectedEvents()):$(".goods-selected-group").hide()}),$(".buy").unbind("click").click(function(){if(1==$(this).data("type")){var t=$(this).closest(".fui-goods-item").data("goodsid");e.open({goodsid:t,total:1})}else window.location.href=$(this).data("url")})},bindSelectedEvents:function(){$(".goods-selected-group .btn-delete").click(function(){$(this).closest(".goods-selected").remove()})},init:function(t){a.indexMid=t,void 0!==window.cartcount&&e.changeCartcount(window.cartcount),a.bindEvents(),$(".fui-content").infinite({onLoading:function(){a.getIndexList()}}),$(".btn-favorite").click(function(){$("#cover").fadeIn(200).click(function(){$("#cover").hide()})}),1==a.indexPage&&a.getIndexList()},getIndexList:function(){a.indexStop||s.json("commission/myshop/get_goods",{page:a.indexPage,mid:a.indexMid},function(t){var e=t.result;e.total<=0?($(".infinite-loading").hide(),$(".xiaodian").hide(),$("#container").hide().$(".fui-content").infinite("stop")):($("#container").show(),$(".xiaodian").show(),$(".fui-content").infinite("init"),e.list.length<=0||e.list.length<e.pagesize?($(".fui-content").infinite("stop"),a.indexStop=!0):a.indexPage++),s.tpl("#container","tpl_commission_myshop_goods_list",e,1<a.indexPage),a.bindEvents()})}};return a});